# 📜 Руководство по скриптам Docker

## 📋 Обзор скриптов

Все скрипты находятся в папке `docker/` и предназначены для управления English Assistant Bot в Docker окружении.

## 🚀 start_project.sh

### Назначение:
Основной скрипт для запуска проекта. Выполняет все необходимые проверки, сборку образов и запуск контейнеров.

### Функции:
- ✅ Проверка наличия Docker и Docker Compose
- ✅ Проверка наличия и корректности .env файла
- ✅ Создание необходимых директорий
- ✅ Остановка существующих контейнеров
- ✅ Сборка Docker образов
- ✅ Запуск сервисов
- ✅ Проверка статуса запуска

### Использование:
```bash
./start_project.sh
```

### Пример вывода:
```
🎓 Запуск English Assistant Bot...
✅ Все проверки пройдены!
📁 Создаем директории...
🛑 Останавливаем существующие контейнеры...
🔨 Собираем Docker образы...
🚀 Запускаем сервисы...
⏳ Ждем запуска сервисов...
📊 Статус контейнеров:
✅ English Assistant Bot запущен!
```

## 🛑 stop_project.sh

### Назначение:
Останавливает все контейнеры проекта.

### Функции:
- 🛑 Остановка всех контейнеров
- 📊 Отображение статуса

### Использование:
```bash
./stop_project.sh
```

### Пример вывода:
```
🛑 Остановка English Assistant Bot...
📦 Останавливаем контейнеры...
✅ English Assistant Bot остановлен!
📊 Статус контейнеров:
💡 Для запуска используйте: ./start_project.sh
```

## 🔄 restart_project.sh

### Назначение:
Перезапускает проект (остановка + запуск).

### Функции:
- 🛑 Остановка контейнеров
- 🚀 Запуск контейнеров
- 📊 Проверка статуса

### Использование:
```bash
./restart_project.sh
```

### Пример вывода:
```
🔄 Перезапуск English Assistant Bot...
🛑 Останавливаем контейнеры...
🚀 Запускаем контейнеры...
⏳ Ждем запуска сервисов...
📊 Статус контейнеров:
✅ English Assistant Bot перезапущен!
```

## 📋 logs.sh

### Назначение:
Просмотр логов различных компонентов системы.

### Параметры:
- `bot` - логи бота
- `db` - логи базы данных
- `all` - все логи

### Использование:
```bash
./logs.sh bot      # Логи бота
./logs.sh db       # Логи базы данных
./logs.sh all      # Все логи
./logs.sh          # Справка
```

### Пример вывода:
```
📋 Логи English Assistant Bot

🤖 Логи бота:
2024-08-14 20:15:30 INFO Bot started
2024-08-14 20:15:31 INFO Connected to database
```

## 💾 backup_db.sh

### Назначение:
Создание резервной копии базы данных.

### Функции:
- 📁 Создание директории backups
- 💾 Создание бэкапа с временной меткой
- 📊 Отображение размера файла
- ✅ Проверка успешности операции

### Использование:
```bash
./backup_db.sh
```

### Пример вывода:
```
💾 Резервное копирование базы данных...
📁 Создаем бэкап: backups/english_bot_backup_20240814_201500.sql
✅ Бэкап успешно создан: backups/english_bot_backup_20240814_201500.sql
📊 Размер файла: 2.5M
💡 Для восстановления из бэкапа используйте:
   docker-compose exec -T postgres psql -U bot_user english_bot < backups/english_bot_backup_20240814_201500.sql
```

## 🔄 restore_db.sh

### Назначение:
Восстановление базы данных из резервной копии.

### Функции:
- 📋 Показ доступных бэкапов
- ⚠️ Запрос подтверждения
- 🛑 Остановка бота
- 🔄 Восстановление БД
- 🚀 Запуск бота
- ✅ Проверка успешности

### Использование:
```bash
./restore_db.sh backups/english_bot_backup_20240814_201500.sql
```

### Пример вывода:
```
🔄 Восстановление базы данных...
📁 Восстанавливаем из файла: backups/english_bot_backup_20240814_201500.sql
⚠️  ВНИМАНИЕ: Это действие перезапишет текущую базу данных!
Продолжить? (y/N): y
🛑 Останавливаем бота...
🔄 Восстанавливаем базу данных...
✅ База данных успешно восстановлена
🚀 Запускаем бота...
✅ Восстановление завершено!
```

## 🧹 clean_project.sh

### Назначение:
Полная очистка проекта (удаление контейнеров, образов, данных).

### Функции:
- ⚠️ Запрос подтверждения
- 🛑 Остановка и удаление контейнеров
- 🗑️ Удаление Docker образов
- 🧹 Очистка неиспользуемых ресурсов
- 📁 Удаление логов и временных файлов

### Использование:
```bash
./clean_project.sh
```

### Пример вывода:
```
🧹 Очистка English Assistant Bot...
⚠️  ВНИМАНИЕ: Это действие удалит все данные и контейнеры!
Продолжить? (y/N): y
🛑 Останавливаем и удаляем контейнеры...
🗑️  Удаляем Docker образы...
🧹 Очищаем неиспользуемые ресурсы Docker...
📁 Удаляем директории логов и временных файлов...
✅ Очистка завершена!
💡 Для запуска используйте: ./start_project.sh
```

## 🔧 Настройка скриптов

### Делаем скрипты исполняемыми:
```bash
chmod +x *.sh
```

### Проверка прав доступа:
```bash
ls -la *.sh
```

### Редактирование скриптов:
```bash
nano start_project.sh
```

## 🛠 Кастомизация

### Изменение портов:
Отредактируйте `docker-compose.yml`:
```yaml
ports:
  - "5435:5432"  # Изменить 5434 на нужный порт
```

### Изменение путей:
Отредактируйте скрипты для изменения путей к файлам.

### Добавление новых проверок:
Добавьте проверки в `start_project.sh`:
```bash
# Пример дополнительной проверки
if [ ! -f "custom_file.txt" ]; then
    echo "❌ custom_file.txt не найден!"
    exit 1
fi
```

## 📊 Мониторинг

### Автоматические проверки:
Скрипты автоматически проверяют:
- ✅ Наличие Docker
- ✅ Наличие Docker Compose
- ✅ Наличие .env файла
- ✅ Корректность переменных окружения
- ✅ Статус контейнеров

### Логирование:
Все операции логируются в:
- 📋 Вывод скриптов
- 📊 Docker логи
- 📁 Файлы логов в папке logs/

## 🔍 Диагностика

### Проверка работоспособности скриптов:
```bash
# Проверяем синтаксис
bash -n *.sh

# Запускаем в режиме отладки
bash -x start_project.sh
```

### Частые проблемы:

#### 1. "Permission denied":
```bash
chmod +x *.sh
```

#### 2. "No such file or directory":
```bash
# Проверяем текущую директорию
pwd
ls -la

# Переходим в папку docker
cd docker
```

#### 3. "Command not found":
```bash
# Проверяем наличие Docker
which docker
which docker-compose
```

## 📞 Поддержка

### Полезные команды:
```bash
# Информация о скриптах
file *.sh
head -5 *.sh

# Проверка зависимостей
which bash
bash --version
```

### Контакты:
- Основная документация: `README.md`
- Документация проекта: `../documentations/PROJECT_GUIDE.md`
- Руководство по деплою: `../documentations/DEPLOYMENT_DOCKER.md`
